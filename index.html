<!doctype html>

<html lang="en">
<head>
	<title>Data Visualizer</title>
	<meta name="description" content="Data visualizer">
	<meta name="author" content="David SolÃ ">
	<meta charset="utf-8">
	<link rel="icon" href="https://avatars1.githubusercontent.com/u/7198106?s=460&u=13c9e8c4189dc06c917948305cae45d8d02d4b0f&v=4">
	
	<script src="https://d3js.org/d3.v4.min.js"></script>

	<!--<link rel="stylesheet" href="css/styles.css?v=1.0">-->

	<style>
		.default {
			fill: steelblue;
		}
		.selected {
			fill: greenyellow;
		}
	</style>

</head>

<body onload="displayChart();">
	<button type="button" onclick="newChart()">New chart</button>
	<button type="button" onclick="bubbleSort()">Sort chart</button>

    <script>
		var widthSvg = 960;
		var heightSvg = 600;

		data = Array.from({ length: 10 }, () => Math.floor(Math.random() * 10));
		data = data.map(elem => ({
			value: elem,
			color: "default"
		}));
		
		function sleep(ms) {
  			return new Promise(resolve => setTimeout(resolve, ms));
		}
		
		function changeColorColumn(index, color) {
			data[index].color = color;
			displayChart();
		}

		async function bubbleSort() {
			var swapped = true;
			while(swapped) {
				swapped = false;
				for (let i = 0; i < data.length -1; ++i) {
					if (data[i].value > data[i + 1].value) {
						swapped = true;
						let tmp = data[i];
						data[i] = data[i + 1];
						data[i + 1] = tmp

						changeColorColumn(i, "selected");
						changeColorColumn(i + 1, "selected");

						await sleep(250);

						changeColorColumn(i, "default");
						changeColorColumn(i + 1, "default");
					}
				}
			}

		}

		function newChart() {
			data = Array.from({ length: 10 }, () => Math.floor(Math.random() * 10));
			data = data.map(elem => ({
				value: elem,
				color: "default"
			}));

			//data[2] = {value: 2, color: "selected"};
			console.log(data);
			displayChart();
		}

		function displayChart() {

			d3.select("svg").remove(); 
			var svg = d3.select("body").append("svg").attr("width", widthSvg).attr("height", heightSvg);


			var svg = d3.select("svg"),
				margin = 200,
				width = svg.attr("width") - margin,
				height = svg.attr("height") - margin;

			svg.append("text")
				.attr("transform", "translate(100,0)")
				.attr("x", 300)
				.attr("y", 50)
				.attr("font-size", "24px")
				.text("Data Visualizer by David");

			var xScale = d3.scaleBand().range([0, width]).padding(0.5),
				yScale = d3.scaleLinear().range([height, 0]);

			xScale.domain(data.map(function(d, i) { return (i+1); }));
			yScale.domain([0, d3.max(data, function(d) { return d.value; })]);

			var g = svg.append("g")
				.attr("transform", "translate(" + 100 + "," + 100 + ")");

			g.append("g")
				.attr("transform", "translate(0," + height + ")")
				.call(d3.axisBottom(xScale));

			g.append("g")
				.call(d3.axisLeft(yScale).tickFormat(function(d){
					return d.value;
				}).ticks(4))
				.append("text")
				.attr("y", 6)
				.attr("dy", "0.71em")
				.attr("text-anchor", "end")
				.text("value");

			g.selectAll(".bar")
				.data(data)
				.enter().append("rect")
				.attr("class", function(d) { return d.color; })
				.attr("x", function(d, i) { return xScale(i+1); })
				.attr("y", function(d) { return yScale(d.value); })
				.attr("width", xScale.bandwidth())
				.attr("height", function(d) { return height - yScale(d.value); });

		}

    </script>
</body>
</html>